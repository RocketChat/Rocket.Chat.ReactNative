appId: chat.rocket.reactnative
name: Required Password Change
jsEngine: graaljs
onFlowStart:
  - runFlow: '../helpers/setup.yaml'
  - evalScript: ${output.createdUser = output.utils.createUserWithPasswordChange()}
onFlowEnd:
  - evalScript: ${output.utils.deleteCreatedUsers()}

---
- runFlow: ../helpers/launch-app.yaml
- runFlow:
    file: ../helpers/login.yaml
    env:
      USERNAME: ${output.createdUser.username}
      PASSWORD: ${output.createdUser.password}
- extendedWaitUntil:
    visible: You need to change your password
    timeout: 60000
- assertVisible:
    id: change-password-required-button
- tapOn:
    id: change-password-required-button
- assertVisible:
    id: change-password-required-sheet-input-password
- tapOn:
    id: change-password-required-sheet-input-password
- inputText: 123456
- hideKeyboard
- assertVisible:
    id: change-password-required-sheet-input-confirm-password
- tapOn:
    id: change-password-required-sheet-input-confirm-password
- inputText: 123456
- hideKeyboard
- assertVisible:
    id: change-password-required-sheet-confirm
- tapOn:
    id: change-password-required-sheet-confirm
- assertVisible:
    id: rooms-list-view
- runFlow: ../helpers/logout.yaml
- runFlow:
    file: ../helpers/login.yaml
    env:
      USERNAME: ${output.createdUser.username}
      PASSWORD: 123456
- assertVisible:
    id: 'rooms-list-view-item-general'
