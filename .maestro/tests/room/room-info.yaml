appId: chat.rocket.reactnative
name: Room Info
onFlowStart:
  - runFlow: '../../helpers/setup.yaml'
onFlowComplete:
  - evalScript: ${output.utils.deleteCreatedUsers()
tags:
  - test-12

---
- evalScript: ${output.user = output.utils.createUser()}
- evalScript: ${output.room = output.utils.createRandomRoom(output.user.username, output.user.password, 'p')}

- runFlow:
    file: '../../helpers/login-with-deeplink.yaml'
    env:
      USERNAME: ${output.user.username}
      PASSWORD: ${output.user.password}
- runFlow:
    file: './utils/navigate-to-room-info.yaml'
    env:
      ROOM: ${output.room.name}

# should have room info view
- extendedWaitUntil:
    visible:
      id: 'room-info-view'
    timeout: 60000

# should have name
- extendedWaitUntil:
    visible:
      id: 'room-info-view-name'
    timeout: 60000

# should have description
- extendedWaitUntil:
    visible:
      text: 'Description'
    timeout: 60000

# should have topic
- extendedWaitUntil:
    visible:
      text: 'Topic'
    timeout: 60000

# should have announcement
- extendedWaitUntil:
    visible:
      text: 'Announcement'
    timeout: 60000

# should have edit button
- extendedWaitUntil:
    visible:
      id: 'room-info-view-edit-button'
    timeout: 60000

- extendedWaitUntil:
    visible:
      id: 'room-info-view-edit-button'
    timeout: 60000
- tapOn:
    id: 'room-info-view-edit-button'
- extendedWaitUntil:
    visible:
      id: 'room-info-edit-view'
    timeout: 60000

# should have room info edit view
- extendedWaitUntil:
    visible:
      id: 'room-info-edit-view'
    timeout: 60000

# should have name input
- extendedWaitUntil:
    visible:
      id: 'room-info-edit-view-name'
    timeout: 60000

# should have description input
- extendedWaitUntil:
    visible:
      id: 'room-info-edit-view-description'
    timeout: 60000

# should have topic input
- extendedWaitUntil:
    visible:
      id: 'room-info-edit-view-topic'
    timeout: 60000

# should have announcement input
- extendedWaitUntil:
    visible:
      id: 'room-info-edit-view-announcement'
    timeout: 60000

# should have password input
- scrollUntilVisible:
    element:
      id: 'room-info-edit-view-password'
    timeout: 60000

# should have type switch
- scrollUntilVisible:
    element:
      id: 'room-info-edit-view-t'
    timeout: 60000

# should have ready only switch
- scrollUntilVisible:
    element:
      id: 'room-info-edit-view-ro'
    timeout: 60000

# should have submit button
- scrollUntilVisible:
    element:
      id: 'room-info-edit-view-submit'
    timeout: 60000

# should have reset button
- scrollUntilVisible:
    element:
      id: 'room-info-edit-view-reset'
    timeout: 60000

# should have archive button
- scrollUntilVisible:
    element:
      id: 'room-info-edit-view-archive'
    timeout: 60000

# should have delete button
- scrollUntilVisible:
    element:
      id: 'room-info-edit-view-delete'
    timeout: 60000

# should reset form
- scrollUntilVisible:
    element:
      id: 'room-info-edit-view-name'
    direction: UP
    timeout: 60000
- tapOn:
    id: room-info-edit-view-name
- eraseText
- inputText: abc
- pressKey: Enter
- assertVisible:
    id: 'room-info-edit-view-topic'
- tapOn:
    id: 'room-info-edit-view-topic'
- inputText: abc
- pressKey: Enter
- assertVisible:
    id: 'room-info-edit-view-announcement'
- tapOn:
    id: 'room-info-edit-view-announcement'
- inputText: abc
- pressKey: Enter
- assertVisible:
    id: 'room-info-edit-view-description'
- tapOn:
    id: 'room-info-edit-view-description'
- inputText: abc
- pressKey: Enter
- assertVisible:
    id: 'room-info-edit-view-password'
- tapOn:
    id: 'room-info-edit-view-password'
- inputText: abc
- scrollUntilVisible:
    element:
      id: 'room-info-edit-view-t'
    timeout: 60000
- tapOn:
    id: 'room-info-edit-view-t'
- scrollUntilVisible:
    element:
      id: 'room-info-edit-view-ro'
    centerElement: true
    timeout: 60000
- tapOn:
    id: 'room-info-edit-view-ro'
- scrollUntilVisible:
    element:
      id: 'room-info-edit-view-react-when-ro'
    direction: UP
    timeout: 60000
- tapOn:
    id: 'room-info-edit-view-react-when-ro'
- scrollUntilVisible:
    element:
      id: 'room-info-edit-view-reset'
    timeout: 60000
- tapOn:
    id: 'room-info-edit-view-reset'

- scrollUntilVisible:
    element:
      text: '.*${output.room.name}.*'
    direction: UP
    timeout: 60000
- assertVisible:
    text: '.*${output.room.name}.*'
    childOf:
      id: 'room-info-edit-view-name'
- scrollUntilVisible:
    element:
      id: 'room-info-edit-view-topic'
    timeout: 60000
- assertVisible:
    text: ''
    childOf:
      id: 'room-info-edit-view-topic'
- scrollUntilVisible:
    element:
      id: 'room-info-edit-view-announcement'
    timeout: 60000
- assertVisible:
    text: ''
    childOf:
      id: 'room-info-edit-view-announcement'
- scrollUntilVisible:
    element:
      id: 'room-info-edit-view-description'
    timeout: 60000
- assertVisible:
    text: ''
    childOf:
      id: 'room-info-edit-view-description'
- scrollUntilVisible:
    element:
      id: 'room-info-edit-view-password'
    timeout: 60000
- assertVisible:
    text: ''
    childOf:
      id: 'room-info-edit-view-password'
- scrollUntilVisible:
    element:
      id: 'room-info-edit-view-t'
    timeout: 60000
- assertVisible:
    checked: false
    childOf:
      id: 'room-info-edit-view-t'
- scrollUntilVisible:
    element:
      id: 'room-info-edit-view-ro'
    timeout: 60000
- assertVisible:
    checked: false
    childOf:
      id: 'room-info-edit-view-ro'
- scrollUntilVisible:
    element:
      id: 'room-info-edit-switch-system-messages'
    timeout: 60000
- assertNotVisible:
    id: 'room-info-edit-view-react-when-ro'

# should change room name
- evalScript: ${output.newroomname = output.room.name + 'new'}
- scrollUntilVisible:
    element:
      id: 'room-info-edit-view-name'
    direction: UP
    timeout: 60000
- tapOn:
    id: 'room-info-edit-view-name'
- runFlow:
    file: '../../helpers/erase-text.yaml'
    env:
      id: 'room-info-edit-view-name'
- inputText: ${output.newroomname}
- pressKey: Enter
- scrollUntilVisible:
    element:
      id: 'room-info-edit-view-submit'
    timeout: 60000
- tapOn:
    id: 'room-info-edit-view-submit'
- extendedWaitUntil:
    visible:
      text: '.*Settings succesfully changed.*'
    timeout: 60000
- tapOn:
    id: custom-header-back
- extendedWaitUntil:
    visible:
      id: 'room-info-view'
    timeout: 60000
- assertVisible:
    text: '.*${output.newroomname}.*'
- tapOn:
    id: room-info-view-edit-button
- extendedWaitUntil:
    visible:
      id: 'room-info-edit-view'
    timeout: 60000

# should change room description, topic, announcement
- scrollUntilVisible:
    element:
      id: 'room-info-edit-view-topic'
    timeout: 60000
- tapOn:
    id: 'room-info-edit-view-topic'
- inputText: 'new topic'
- scrollUntilVisible:
    element:
      id: 'room-info-edit-view-announcement'
    timeout: 60000
- tapOn:
    id: 'room-info-edit-view-announcement'
- inputText: 'new announcement'
- scrollUntilVisible:
    element:
      id: 'room-info-edit-view-description'
    timeout: 60000
- tapOn:
    id: 'room-info-edit-view-description'
- inputText: 'new description'
- pressKey: Enter
- scrollUntilVisible:
    element:
      id: 'room-info-edit-view-submit'
    timeout: 60000
- tapOn:
    id: 'room-info-edit-view-submit'
- extendedWaitUntil:
    visible:
      text: '.*Settings succesfully changed.*'
    timeout: 60000
- tapOn:
    id: custom-header-back
- extendedWaitUntil:
    visible:
      id: 'room-info-view'
    timeout: 60000
- assertVisible:
    text: '.*new description.*'
- assertVisible:
    text: '.*new topic.*'
- assertVisible:
    text: '.*new announcement.*'
- tapOn:
    id: room-info-view-edit-button
- extendedWaitUntil:
    visible:
      id: 'room-info-edit-view'
    timeout: 60000

# should change room type
- scrollUntilVisible:
    element:
      id: 'room-info-edit-view-t'
    timeout: 60000
- tapOn:
    id: 'room-info-edit-view-t'
- scrollUntilVisible:
    element:
      id: 'room-info-edit-view-submit'
    timeout: 60000
- tapOn:
    id: 'room-info-edit-view-submit'
- extendedWaitUntil:
    visible:
      text: '.*Settings succesfully changed.*'
    timeout: 60000

# should archive room
- scrollUntilVisible:
    element:
      id: 'room-info-edit-view-archive'
    timeout: 60000
- tapOn:
    id: 'room-info-edit-view-archive'
- extendedWaitUntil:
    visible:
      text: '.*Do you really want to archive this room.*'
    timeout: 60000
- extendedWaitUntil:
    visible:
      text: '.*Yes, archive it.*'
    timeout: 60000
- tapOn:
    text: 'Yes, archive it.'

# should delete room
- scrollUntilVisible:
    element:
      id: 'room-info-edit-view-delete'
    timeout: 60000
- tapOn:
    id: 'room-info-edit-view-delete'
- extendedWaitUntil:
    visible:
      text: '.*Deleting a room will delete all messages posted within the room. This cannot be undone..*'
    timeout: 60000
- extendedWaitUntil:
    visible:
      text: '.*YES, DELETE IT!.*'
    timeout: 60000
- tapOn:
    text: '.*YES, DELETE IT.*'

# should see user role correctly
- runFlow:
    file: './utils/navigate-to-room-info.yaml'
    env:
      ROOM: 'roles-test'
- extendedWaitUntil:
    visible:
      id: 'user-roles'
    timeout: 60000
- assertVisible:
    id: 'user-role-Livechat-Agent'
