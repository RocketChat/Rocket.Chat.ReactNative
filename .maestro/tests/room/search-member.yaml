appId: chat.rocket.reactnative
name: Search Member
onFlowStart:
  - runFlow: '../../helpers/setup.yaml'
tags:
  - test-13

---
- evalScript: ${output.user = output.utils.createUser()}

- runFlow:
    file: '../../helpers/login-with-deeplink.yaml'
    env:
      USERNAME: ${output.user.username}
      PASSWORD: ${output.user.password}

- runFlow:
    file: '../../helpers/navigate-to-room.yaml'
    env:
      ROOM: 'general'
- tapOn:
    id: room-header
- extendedWaitUntil:
    visible:
      id: 'room-actions-view'
    timeout: 60000
- tapOn:
    id: 'room-actions-members'
- extendedWaitUntil:
    visible:
      id: 'room-members-view-search'
    timeout: 60000

# should search in all users
- tapOn:
    id: room-members-view-search
- inputText: rohit.bansal
- extendedWaitUntil:
    visible:
      id: 'room-members-view-item-rohit.bansal'
    timeout: 60000

# use online status and it should use the text filter
- tapOn:
    id: room-members-view-filter
- extendedWaitUntil:
    visible:
      id: 'room-members-view-toggle-status-online'
    timeout: 60000
- tapOn:
    id: room-members-view-toggle-status-online
- extendedWaitUntil:
    visible:
      text: 'No members found'
    timeout: 60000

# use all status again and it should use text filter
- tapOn:
    id: room-members-view-filter
- extendedWaitUntil:
    visible:
      id: 'room-members-view-toggle-status-all'
    timeout: 60000
- tapOn:
    id: room-members-view-toggle-status-all
- extendedWaitUntil:
    visible:
      id: 'room-members-view-item-rohit.bansal'
    timeout: 60000
- tapOn:
    id: clear-text-input

- evalScript: ${output.secondUser = output.utils.createUser()}

# should search for new user in all list
- tapOn:
    id: room-members-view-search
- inputText: ${output.secondUser.username}
- extendedWaitUntil:
    visible:
      id: 'room-members-view-item-${output.secondUser.username}'
    timeout: 60000
