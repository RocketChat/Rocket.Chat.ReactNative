appId: chat.rocket.reactnative
name: Accessibility and Appearance
onFlowStart:
  - runFlow: '../../helpers/setup.yaml'
onFlowComplete:
  - evalScript: ${output.utils.deleteCreatedUsers()}
tags:
  - test-5

---
- evalScript: ${output.user = output.utils.createUser()}
- runFlow:
    file: '../../helpers/login-with-deeplink.yaml'
    env:
      username: ${output.user.username}
      password: ${output.user.password}
- runFlow:
    file: './utils/go-to-accessibility-appearance.yaml'

# should have accessibility view list
- extendedWaitUntil:
    visible:
      id: 'accessibility-view-list'
    timeout: 60000

# should have menu button
- extendedWaitUntil:
    visible:
      id: 'accessibility-view-drawer'
    timeout: 60000

# should have theme button
- extendedWaitUntil:
    visible:
      id: 'accessibility-theme-button'
    timeout: 60000

# should have display button
- extendedWaitUntil:
    visible:
      id: 'accessibility-display-button'
    timeout: 60000

# should have rooms with hashtag symbol switch
- extendedWaitUntil:
    visible:
      id: 'accessibility-rooms-with-hashtag-symbol-switch'
    timeout: 60000

# should have mentions with at symbol switch
- extendedWaitUntil:
    visible:
      id: 'accessibility-mentions-with-at-symbol-switch'
    timeout: 60000

# should have autoplay gifs switch
- extendedWaitUntil:
    visible:
      id: 'accessibility-autoplay-gifs-switch'
    timeout: 60000

# should enable mentions with @ symbol
- extendedWaitUntil:
    visible:
      id: 'accessibility-mentions-with-at-symbol-switch'
    timeout: 60000
- tapOn:
    id: 'accessibility-mentions-with-at-symbol-switch'

- extendedWaitUntil:
    visible:
      id: 'accessibility-view-drawer'
    timeout: 60000
- tapOn:
    id: 'accessibility-view-drawer'
- extendedWaitUntil:
    visible:
      id: 'sidebar-chats'
    timeout: 60000
- tapOn:
    id: 'sidebar-chats'
- runFlow:
    file: '../../helpers/search-and-navigate-room.yaml'
    env:
      ROOM: 'maestro-accessibility-test'

- extendedWaitUntil:
    visible:
      text: '.*@all - all mention.*'
    timeout: 60000
- extendedWaitUntil:
    visible:
      text: '.*@rocket.cat - user mention.*'
    timeout: 60000

# should disable mentions with @ symbol
- tapOn:
    id: header-back
- runFlow:
    file: './utils/go-to-accessibility-appearance.yaml'

- extendedWaitUntil:
    visible:
      id: 'accessibility-mentions-with-at-symbol-switch'
    timeout: 60000
- tapOn:
    id: 'accessibility-mentions-with-at-symbol-switch'

- extendedWaitUntil:
    visible:
      id: 'accessibility-view-drawer'
    timeout: 60000
- tapOn:
    id: 'accessibility-view-drawer'
- extendedWaitUntil:
    visible:
      id: 'sidebar-chats'
    timeout: 60000
- tapOn:
    id: 'sidebar-chats'
- runFlow:
    file: '../../helpers/search-and-navigate-room.yaml'
    env:
      ROOM: 'maestro-accessibility-test'

- extendedWaitUntil:
    visible:
      text: '.*all - all mention.*'
    timeout: 60000
- extendedWaitUntil:
    notVisible:
      text: '.*@all - all mention.*'
    timeout: 60000
- extendedWaitUntil:
    visible:
      text: '.*rocket.cat - user mention.*'
    timeout: 60000
- extendedWaitUntil:
    notVisible:
      text: '.*@rocket.cat - user mention.*'
    timeout: 60000

# should enable rooms with # symbol
- tapOn:
    id: header-back
- runFlow:
    file: './utils/go-to-accessibility-appearance.yaml'

- extendedWaitUntil:
    visible:
      id: 'accessibility-rooms-with-hashtag-symbol-switch'
    timeout: 60000
- tapOn:
    id: 'accessibility-rooms-with-hashtag-symbol-switch'

- extendedWaitUntil:
    visible:
      id: 'accessibility-view-drawer'
    timeout: 60000
- tapOn:
    id: 'accessibility-view-drawer'
- extendedWaitUntil:
    visible:
      id: 'sidebar-chats'
    timeout: 60000
- tapOn:
    id: 'sidebar-chats'
- runFlow:
    file: '../../helpers/search-and-navigate-room.yaml'
    env:
      ROOM: 'maestro-accessibility-test'

- extendedWaitUntil:
    visible:
      text: '.*#general - channel mention.*'
    timeout: 60000

# should disable mentions with # symbol
- tapOn:
    id: header-back
- runFlow:
    file: './utils/go-to-accessibility-appearance.yaml'

- extendedWaitUntil:
    visible:
      id: 'accessibility-rooms-with-hashtag-symbol-switch'
    timeout: 60000
- tapOn:
    id: 'accessibility-rooms-with-hashtag-symbol-switch'

- extendedWaitUntil:
    visible:
      id: 'accessibility-view-drawer'
    timeout: 60000
- tapOn:
    id: 'accessibility-view-drawer'
- extendedWaitUntil:
    visible:
      id: 'sidebar-chats'
    timeout: 60000
- tapOn:
    id: 'sidebar-chats'
- runFlow:
    file: '../../helpers/search-and-navigate-room.yaml'
    env:
      ROOM: 'maestro-accessibility-test'

- extendedWaitUntil:
    visible:
      text: '.*general - channel mention.*'
    timeout: 60000
- extendedWaitUntil:
    notVisible:
      text: '.*#general - channel mention.*'
    timeout: 60000
