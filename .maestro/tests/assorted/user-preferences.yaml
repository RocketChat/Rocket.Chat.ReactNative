appId: chat.rocket.reactnative
name: User Preferences
onFlowStart:
  - runFlow: '../../helpers/setup.yaml'
onFlowComplete:
  - evalScript: ${output.utils.deleteCreatedUsers()}

---
- evalScript: ${output.user = output.utils.createUser()}
- runFlow: ../../helpers/launch-app.yaml
- runFlow:
    file: '../../helpers/login.yaml'
    env:
      USERNAME: ${output.user.username}
      PASSWORD: ${output.user.password}
- runFlow:
    file: './utils/go-to-user-preference.yaml'

# should have notifications button
- extendedWaitUntil:
    visible:
      id: 'preferences-view-notifications'
    timeout: 60000

# should have also send to channel select
- extendedWaitUntil:
    visible:
      id: 'preferences-view-enable-message-parser'
    timeout: 60000

# should have also send to channel select
- extendedWaitUntil:
    visible:
      id: 'preferences-view-enable-message-parser'
    timeout: 60000

# should have convert ascii to emoji switch
- extendedWaitUntil:
    visible:
      id: 'preferences-view-convert-ascii-to-emoji'
    timeout: 60000

# ASCII should be converted to emoji
- tapOn:
    id: 'custom-header-back'
- extendedWaitUntil:
    visible:
      id: 'profile-view'
    timeout: 60000
- tapOn:
    id: 'profile-view-open-sidebar'
- extendedWaitUntil:
    visible:
      id: 'sidebar-view'
    timeout: 60000
- extendedWaitUntil:
    visible:
      id: 'sidebar-chats'
    timeout: 60000
- tapOn:
    id: 'sidebar-chats'
- runFlow:
    file: '../../helpers/search-room.yaml'
    env:
      ROOM: 'maestro-ascii-emoji-test'
- extendedWaitUntil:
    visible:
      id: 'rooms-list-view-item-maestro-ascii-emoji-test'
    timeout: 60000
- extendedWaitUntil:
    visible:
      text: 'e2e_admin: :('
    timeout: 60000
- tapOn:
    id: 'rooms-list-view-item-maestro-ascii-emoji-test'
- extendedWaitUntil:
    visible:
      id: 'message-content-:('
    timeout: 60000
- extendedWaitUntil:
    notVisible:
      id: 'message-content-ðŸ˜ž'
    timeout: 60000

# ASCII should be converted to emoji
- tapOn:
    id: 'header-back'
- runFlow:
    file: './utils/go-to-user-preference.yaml'
- extendedWaitUntil:
    visible:
      id: 'preferences-view-convert-ascii-to-emoji'
    timeout: 60000
- tapOn:
    id: 'preferences-view-convert-ascii-to-emoji'
- tapOn:
    id: 'custom-header-back'
- extendedWaitUntil:
    visible:
      id: 'profile-view'
    timeout: 60000
- tapOn:
    id: 'profile-view-open-sidebar'
- extendedWaitUntil:
    visible:
      id: 'sidebar-view'
    timeout: 60000
- extendedWaitUntil:
    visible:
      id: 'sidebar-chats'
    timeout: 60000
- tapOn:
    id: 'sidebar-chats'
- runFlow:
    file: '../../helpers/search-room.yaml'
    env:
      ROOM: 'maestro-ascii-emoji-test'
- extendedWaitUntil:
    visible:
      id: 'rooms-list-view-item-maestro-ascii-emoji-test'
    timeout: 60000
- extendedWaitUntil:
    visible:
      text: 'e2e_admin: ðŸ˜ž'
    timeout: 60000
- tapOn:
    id: 'rooms-list-view-item-maestro-ascii-emoji-test'
- extendedWaitUntil:
    visible:
      text: 'ðŸ˜ž'
    timeout: 60000
- extendedWaitUntil:
    notVisible:
      text: ':('
    timeout: 60000
