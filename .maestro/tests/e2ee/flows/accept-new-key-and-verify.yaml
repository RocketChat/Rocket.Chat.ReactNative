appId: chat.rocket.reactnative
name: Accept New Key and Verify Messages
tags:
  - 'flow'
env:
  MESSAGE_1: m0
  MESSAGE_2: m1
  MESSAGE_3: m2
  MESSAGE_4: m3
  MESSAGE_5: m4
  NEW_MESSAGE: m5
---
- runFlow: '../../../helpers/launch-app.yaml'
- runFlow:
    file: '../../../helpers/login.yaml'
    env:
      USERNAME: ${USERNAME}
      PASSWORD: ${PASSWORD}
- runFlow:
    file: '../../../helpers/navigate-to-room.yaml'
    env:
      ROOM: ${ROOM}
- runFlow: '../utils/enter-e2e-key.yaml'

# Send a message
- runFlow:
    file: '../../../helpers/send-message.yaml'
    env:
      message: ${NEW_MESSAGE}

# Verify all messages are visible
- extendedWaitUntil:
    visible:
      text: '.*${MESSAGE_1}.*'
    timeout: 60000
- extendedWaitUntil:
    visible:
      text: '.*${MESSAGE_2}.*'
    timeout: 60000
- extendedWaitUntil:
    visible:
      text: '.*${MESSAGE_3}.*'
    timeout: 60000
- extendedWaitUntil:
    visible:
      text: '.*${MESSAGE_4}.*'
    timeout: 60000
- extendedWaitUntil:
    visible:
      text: '.*${MESSAGE_5}.*'
    timeout: 60000
- extendedWaitUntil:
    visible:
      text: '.*${NEW_MESSAGE}.*'
    timeout: 60000
